<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="refresh" content="6">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <title>Welcome to OurBank!</title>
</head>
<body>
    <main>
      <header><h1><b style="font-size: 1.5em">NOMONEY BANK</b> . {{title}} Branch</h1></header>
        <section class="display">
            <h1 id = "SuccessOrNot"></h1>
            <h1 class="headtitle">-- Your Ticket --</h1>
            <h1 class="password displayTicket" id="currentTicketNum"></h1>
            <h2 style="text-align: center;font-size: 4em;color: #483D8B" id = "notServingShowText"></h2>
            <h4 class="counter displayCounter" id="thanksOrAlert" style="color: #BEBEBE">-</h4>
            <h4 class="lastTicket">-</h4>
        </section>
        <section class="grid">
            <div>
                <br>
                <h2 style="font-size: 2em">- Dear Customer - </h2>
                <h3>Please Choose Your Requirement Here</h3><br>
                <button class="buttons clientsbuttonC" id="InsertBusiness">Business</button>
                <button class="buttons clientsbuttonQ" id="InsertPrivate">Private</button>
                <button class="buttons clientsbuttonP" id="InsertSenior">Senior</button>

            </div>
        </section>
        </div>
    </main>
    <footer>NOMONEY BANK &copy; - No Money Â· No Worries </footer>
<!--<script src="/js/dataset_bank0.js"></script>-->
<script>

InsertPrivate.onclick=function(){
    var curWwwPath = window.document.location.href;
    var pathName = window.document.location.pathname;
    var localhostPath=curWwwPath.substring(0, curWwwPath.indexOf(pathName));
    var projectName = pathName.substring(0,pathName.substr(1).indexOf('/')+1);
    var pathName = window.document.location.pathname;
    var apiForPushQueue = localhostPath+pathName.slice(0,11)+'/priQueue/push'
    var xhr1=new XMLHttpRequest();
    xhr1.open('get',apiForPushQueue)
    xhr1.send();
    xhr1.onload=function(){
        //xhrå¯¹è±¡é‡Œçš„responseTextå±æ€§å°±å­˜å‚¨ç€å“åº”æ•°æ®
        if(xhr1.responseText.search("not serving") != -1 ){
            SuccessOrNot.innerHTML = "ğŸ˜¥ UNSUCCESSFUL"
            notServingShowText.innerHTML = xhr1.responseText.substring(1,27);
            currentTicketNum.innerHTML = "";
            thanksOrAlert.innerHTML = "Please contact CRO staff."
            console.log(xhr1.responseText)
        }else{
            resData = JSON.parse(xhr1.responseText)
            currentQueueNum = resData["privateQueue"].slice(-1)
            console.log('å“åº”',currentQueueNum);//å“åº”ä¸ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹
            //æ¥ä¸‹æ¥å°±å¯ä»¥å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­äº†
            SuccessOrNot.innerHTML = "ğŸ˜ SUCCESSFUL"
            thanksOrAlert.innerHTML = "NO MONYE Â· NO WORRIES";
            currentTicketNum.innerHTML = currentQueueNum;
            notServingShowText.innerHTML = "";
        }
    }

}

InsertSenior.onclick=function(){
    var curWwwPath = window.document.location.href;
    var pathName = window.document.location.pathname;
    var localhostPath=curWwwPath.substring(0, curWwwPath.indexOf(pathName));
    var projectName = pathName.substring(0,pathName.substr(1).indexOf('/')+1);
    var pathName = window.document.location.pathname;
    var apiForPushQueue = localhostPath+pathName.slice(0,11)+'/senQueue/push'
    var xhr2=new XMLHttpRequest();
    //è¿™ä¸ªè¯·æ±‚å®é™…æ˜¯æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯çš„
    //è¯·æ±‚å¯¹è±¡çš„è®¾ç½® å‘Šè¯‰ajaxå¯¹è±¡ï¼Œè¦å‘é‚£é‡Œå‘é€è¯·æ±‚ï¼Œä»¥ä»€ä¹ˆæ–¹å¼å‘é€è¯·æ±‚
    xhr2.open('get',apiForPushQueue)
    //è°ƒç”¨xhrå¯¹è±¡ä¸‹çš„sendæ–¹æ³• å‘é€è¯·æ±‚
    xhr2.send();
    //è·å–æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯çš„å“åº”æ•°æ®
    // xhrå¯¹è±¡çš„onloadäº‹ä»¶åœ¨æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯åšå‡ºå“åº”åå°±ä¼šè§¦å‘
    xhr2.onload=function(){
        //xhrå¯¹è±¡é‡Œçš„responseTextå±æ€§å°±å­˜å‚¨ç€å“åº”æ•°æ®
        if(xhr2.responseText.search("not serving") != -1 ){
            SuccessOrNot.innerHTML = "ğŸ˜¥ UNSUCCESSFUL"
            notServingShowText.innerHTML = xhr2.responseText.substring(1,27);
            currentTicketNum.innerHTML = "";
            thanksOrAlert.innerHTML = "Please contact CRO staff."
            // console.log(xhr2.responseText)
        }else{
            resData = JSON.parse(xhr2.responseText)
            currentQueueNum = resData["seniorQueue"].slice(-1)
            // console.log('å“åº”',currentQueueNum);//å“åº”ä¸ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹
            //æ¥ä¸‹æ¥å°±å¯ä»¥å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­äº†
            thanksOrAlert.innerHTML = "NO MONYE Â· NO WORRIES"
            SuccessOrNot.innerHTML = "ğŸ˜ SUCCESSFUL"
            currentTicketNum.innerHTML = currentQueueNum;
            notServingShowText.innerHTML = "";
        }
    }

}

InsertBusiness.onclick=function(){
    var curWwwPath = window.document.location.href;
    var pathName = window.document.location.pathname;
    var localhostPath=curWwwPath.substring(0, curWwwPath.indexOf(pathName));
    var projectName = pathName.substring(0,pathName.substr(1).indexOf('/')+1);
    var pathName = window.document.location.pathname;
    var apiForPushQueue = localhostPath+pathName.slice(0,11)+'/bizQueue/push'
    var xhr3=new XMLHttpRequest();
    console.log(apiForPushQueue)
    xhr3.open('get',apiForPushQueue)
    xhr3.send();
    xhr3.onload=function(){
        if(xhr3.responseText.search("not serving") != -1 ){
            SuccessOrNot.innerHTML = "ğŸ˜¥ UNSUCCESSFUL"
            notServingShowText.innerHTML = xhr3.responseText.substring(1,27);
            currentTicketNum.innerHTML = "";
            console.log(xhr3.responseText)
        }else{
            resData = JSON.parse(xhr3.responseText)
            currentQueueNum = resData.slice(-1)
            // console.log('å“åº”',currentQueueNum);//å“åº”ä¸ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹
            //æ¥ä¸‹æ¥å°±å¯ä»¥å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­äº†
            thanksOrAlert.innerHTML = "NO MONYE Â· NO WORRIES"
            SuccessOrNot.innerHTML = "ğŸ˜ SUCCESSFUL"
            currentTicketNum.innerHTML = currentQueueNum;
            notServingShowText.innerHTML = "";
        }
    }

}

</script>
</body>
</html>